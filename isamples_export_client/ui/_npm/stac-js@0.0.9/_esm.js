/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/stac-js@0.0.9/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import t from"../@radiantearth/stac-migrate@1.6.0/_esm.js";import e from"../urijs@1.19.11/_esm.js";function r(t){let e=t.length>=6,r={west:t[0],east:t[e?3:2],south:t[1],north:t[e?4:3]};return e&&(r.base=t[2],r.height=t[5]),r}function n(t){let{west:e,east:n,south:s,north:i}=r(t);return[[[e,i],[e,s],[n,s],[n,i],[e,i]]]}function s(t){if(!Array.isArray(t)||![4,6].includes(t.length)||t.some((t=>"number"!=typeof t)))return!1;let{west:e,east:n,south:s,north:i}=r(t);return s<=i&&e>=-180&&e<=180&&s>=-90&&n<=180&&n>=-180&&i<=90}function i(t){if(!s(t))return!1;let{west:e,east:n}=r(t);return e>n}function l(t){if(!Array.isArray(t)||0===t.length)return null;let e={west:180,south:90,east:-180,north:-90};t.forEach((t=>{if(!s(t))return;let n=r(t),i=["west","south"];for(let t in n){let r=i.includes(t)?Math.min:Math.max;e[t]=r(e[t],n[t])}}));let n=[e.west,e.south,e.east,e.north];return s(n)?n:null}function u(t){return"string"==typeof t&&t.length>0}function a(t){return"object"==typeof t&&t===Object(t)&&!Array.isArray(t)}function o(...t){if((t=t.filter((t=>Array.isArray(t)))).length>1){let e=Math.max(...t.map((t=>t.length))),r=[];for(let n=0;n<e;n++)r.push(Object.assign({},...t.map((t=>t[n]))));return r}return 1===t.length?t[0]:[]}class h{constructor(t,e={},r=[]){if(!a(t))throw new Error("Given data is not an object");if(t instanceof h){for(let e of r)this[e]=t[e];t=t.toJSON()}this._keyMap=e,this._privateKeys=["_keyMap","_privateKeys"].concat(r);for(let r in t)void 0===this[r]&&(this[r]=r in e?e[r](t[r],this):t[r])}isItem(){return"Feature"===this.type}isCatalog(){return"Catalog"===this.type}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return"Collection"===this.type}isItemCollection(){return"FeatureCollection"===this.type}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(t){return this[t]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return function(t){if(!s(t))return null;let e=r(t),n=[];if(i(t)){let t=(e.west+360+e.east)/2;t>180&&(t-=360),n.push(t)}else n.push((e.west+e.east)/2);return n.push((e.south+e.north)/2),void 0!==e.base&&n.push((e.base+e.height)/2),n}(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let t={};return Object.keys(this).forEach((e=>{if("function"==typeof this[e]||this._privateKeys.includes(e))return;let r=this[e];if(e in this._keyMap){let t=Array.isArray(r)?[]:{};for(let e in r)t[e]=r[e].toJSON();r=t}t[e]=r})),t}}const c=["http","https"];function g(t,r,n=!0){return function(t,r=null,n=!1,s=!0){"string"==typeof t&&t.startsWith("/vsicurl/")&&(t=t.replace(/^\/vsicurl\//,""));let i=e(t);if(r&&i.is("relative")&&!function(t){return"string"==typeof t&&t.startsWith("/vsi")&&!t.startsWith("/vsicurl/")}(t)){let t=e(r),n=t.path();n.endsWith("/")||n.endsWith(".json")||t.path(n+"/"),i=i.absoluteTo(t)}i.normalize(),n&&(i.query(""),i.fragment(""));return s?i.toString():i}(t,r,!1,n)}const m=["application/json","application/geo+json","text/json"],p=["image/gif","image/jpeg","image/apng","image/png","image/webp"],f=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],d=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(f);function y(t,e,r=!1){return Array.isArray(e)||(e=[e]),!(!r||void 0!==t)||"string"==typeof t&&(e=e.map((t=>t.toLowerCase())),e.includes(t.toLowerCase()))}class x extends h{constructor(t,e=null,r={},n=[]){super(t,r,["_context"].concat(n)),this._context||(this._context=e)}getAbsoluteUrl(t=!0){return this._context?g(this.href,this._context.getAbsoluteUrl(),t):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(t=!1){if("string"!=typeof this.href)return!1;if(!t&&void 0===this.type)return!1;let r=new e(this.href),n=r.protocol().toLowerCase(),s=r.suffix().toLowerCase();return!(u(n)&&!c.includes(n))&&(!(!u(this.type)||!p.includes(this.type.toLowerCase()))||!(void 0!==this.type||!u(s)||"jpg"!==s&&!p.includes("image/"+s)))}isType(t){return u(this.type)&&y(this.type,t)}isGeoTIFF(){return this.isType(d)}isCOG(){return this.isType(f)}isHTTP(){let t=this.getAbsoluteUrl(!1).protocol().toLowerCase();return u(t)&&c.includes(t)}}class A extends x{constructor(t,e=null){super(t,e)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(t,e=null){return Array.isArray(t)?t.map((t=>a(t)?new A(t,e):t)):[]}}class b extends h{constructor(t,e=null,r={},n=[]){if(super(t,Object.assign({links:A.fromLinks},r),["_url"].concat(n)),!this._url&&(this._url=e,!this._url)){let t=this.getSelfLink();t&&(this._url=t.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(t){this._url=t}getStacLinksWithRel(t,e=!0){return this.getLinksWithRels([t]).filter((t=>function(t,e=!1){return y(t,m,e)}(t.type,e)))}getStacLinkWithRel(t,e=!0){const r=this.getStacLinksWithRel(t,e);return r.length>0?r[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter((t=>a(t)&&u(t.href))):[]}getLinkWithRel(t){return this.getLinks().find((e=>e.rel===t))||null}getLinksWithRels(t){return this.getLinks().filter((e=>t.includes(e.rel)))}getLinksWithOtherRels(t){return this.getLinks().filter((e=>!t.includes(e.rel)))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class B extends b{constructor(t,e=null,r={},n=[]){super(t,e,r,n)}getAll(){return[]}}class k extends x{constructor(t,e=null,r=null){super(t,r,{},["_key"]),this._key||(this._key=e)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(t=!0){return this.isDefinition()?null:super.getAbsoluteUrl(t)}getKey(){return this._key}getMetadata(t){return void 0!==this[t]?this[t]:this._context?this._context.getMetadata(t):void 0}getBands(){return o(this["eo:bands"],this["raster:bands"])}findVisualBands(){let t={red:null,green:null,blue:null},e=this.getBands();for(let r in e){let n=parseInt(r,10),s=e[n];a(s)&&u(s.common_name)&&s.common_name in t&&(t[s.common_name]={index:n,band:s})}return Object.values(t).every((t=>null!==t))?t:null}findBand(t,e="name",r=null){Array.isArray(t)||(t=[t]),a(r)||(r=this.getBands());let n=r.findIndex((r=>a(r)&&t.includes(r[e])));return n>=0?{index:n,band:r[n]}:null}getBand(t){if(a(t)||null===t)return t;return this.getBands()[t]||null}getMinMaxValues(t=null){const e={minimum:null,maximum:null},r=t=>null!==t.minimum&&null!==t.maximum;if(t=this.getBand(t)){if(a(t.statistics)&&("number"==typeof t.statistics.minimum&&(e.minimum=t.statistics.minimum),"number"==typeof t.statistics.maximum&&(e.maximum=t.statistics.maximum),r(e)))return e;if(a(t.histogram)&&("number"==typeof t.histogram.min&&(e.minimum=t.histogram.min),"number"==typeof t.histogram.max&&(e.maximum=t.histogram.max),r(e)))return e}let n=this.getMetadata("classification:classes");if(Array.isArray(n)&&(n.reduce(((t,e)=>(t.minimum=Math.min(t.minimum,e.value),t.maximum=Math.max(t.maximum,e.value),t)),e),r(e)))return e;let s=this.getMetadata("file:values");if(Array.isArray(s)&&(s.reduce(((t,e)=>(t.minimum=Math.min(t.minimum,...e.values),t.maximum=Math.max(t.maximum,...e.values),t)),e),r(e)))return e;let i=a(t)&&t.data_type||this.getMetadata("file:data_type");return i&&(e.minimum=function(t){switch(t){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return t.startsWith("u")?0:null}(i),e.maximum=function(t){switch(t){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}(i)),e}getNoDataValues(t=null){let e=[];if((t=this.getBand(t))&&void 0!==t.nodata)e.push(t.nodata);else{let t=this.getMetadata("file:nodata");if(void 0!==t)e=t;else{let t=this.getMetadata("classification:classes");Array.isArray(t)&&(e=t.filter((t=>Boolean(t.nodata))).map((t=>t.value)))}}return e.map((t=>"nan"===t?NaN:"+inf"===t?1/0:"-inf"===t?-1/0:t))}isDefinition(){return!u(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}hasRole(t,e=!1){return Array.isArray(t)||(t=[t]),!(!e||!t.includes(this.getKey()))||Array.isArray(this.roles)&&Boolean(this.roles.find((e=>t.includes(e))))}static fromAssets(t,e=null){let r={};if(a(t))for(let n in t)r[n]=new k(t[n],n,e);return r}}class T extends b{constructor(t,e=null,r={},n=[]){super(t,e,r,n)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(t=!0){return this.getLinksWithRels(["icon"]).filter((e=>e.canBrowserDisplayImage(t)))}getThumbnails(t=!0,e=null){let r=this.getAssetsWithRoles(["thumbnail","overview"],!0);if(0===r.length&&(r=this.getLinksWithRels(["preview"])),t&&(r=r.filter((t=>t.canBrowserDisplayImage()))),e&&r.length>1){let t=t=>Array.isArray(t.roles)&&t.roles.includes(e)||t.getKey()===e;r=r.filter(t).concat(r.filter((e=>!t(e))))}return r}getDefaultGeoTIFF(t=!0,e=!1){let r=this.rankGeoTIFFs(t,e);return r[0]?.asset}rankGeoTIFFs(t=!0,e=!1,r=null,n=null){a(r)||(r={data:1,visual:2,thumbnail:2,overview:3});let s=[],i=this.getAssetsByTypes(d);t&&(i=i.filter((t=>t.isHTTP()&&(!e||t.isCOG()))));let l=Object.entries(r);for(let t of i){let r=0;if(l.length>0){let e=l.filter((([e])=>t.hasRole(e,!0))).map((([,t])=>t));e.length>0&&(r+=Math.max(...e))}!e&&t.isCOG()&&(r+=2),t.findVisualBands()&&(r+=1),"function"==typeof n&&(r+=n(t)),s.push({asset:t,score:r})}return s.sort(((t,e)=>e.score-t.score)),s}findVisualAssets(){let t={red:null,green:null,blue:null},e=Object.keys(t),r=this.getAssets();for(let n of r){let r=n.getBands();if(1!==r.length)continue;let s=n.findBand(e,"common_name",r);s&&(t[s.band.common_name]=n)}return Object.values(t).every((t=>null!==t))?t:null}getAsset(t){return a(this.assets)&&this.assets[t]||null}getAssets(){return a(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(t,e=!1){return this.getAssets().filter((r=>r.hasRole(t,e)))}getAssetWithRole(t,e=!1){return this.getAssetsWithRoles([t],e)[0]||null}getAssetsByTypes(t){return this.getAssets().filter((e=>y(e.type,t)))}equals(t){return this===t||t instanceof T&&(this.getObjectType()===t.getObjectType()&&!(!this.id||this.id!==t.id))}}class w extends T{constructor(t,e=null,r={},n=[]){super(t,e,r,n)}getObjectType(){return this.type}getSearchLink(t=null){let e=this.getStacLinksWithRel("search");return t?e[0]||null:e.find((e=>e.method===t||!t&&!e.method))||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class L extends w{constructor(t,e=null){super(t,e)}}function v(t){if(u(t)&&t.length>=10)try{let e=t.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map((t=>parseInt(t,10)));return new Date(Date.UTC(e[0],e[1]-1,e[2],e[3],e[4],e[5],e[6]||0))}catch(t){return null}return null}function _(t){if(!Array.isArray(t)||0===t.length)return null;let e,r;const n=(t,e,r)=>void 0===t?e:null===t||null===e?null:r(t,e);return t.forEach((([t,s])=>{e=n(e,t,Math.min),r=n(r,s,Math.max)})),[null===e?null:new Date(e),null===r?null:new Date(r)]}class C extends w{constructor(t,e=null){super(t,e,{assets:k.fromAssets,item_assets:k.fromAssets})}toGeoJSON(){let t=function(t){if(s(t)?t=[t]:Array.isArray(t)&&(t=t.filter((t=>s(t)))),!Array.isArray(t)||0===t.length)return null;let e=t.reduce(((t,e)=>{if(i(e)){let{west:s,east:i,south:l,north:u}=r(e);t.push(n([-180,l,i,u])),t.push(n([s,l,180,u]))}else t.push(n(e));return t}),[]),l=null;return 1===e.length?l={type:"Polygon",coordinates:e[0]}:e.length>1&&(l={type:"MultiPolygon",coordinates:e}),l?{type:"Feature",geometry:l,properties:{}}:void 0}(this.getBoundingBoxes());return t&&(t.id=this.id),t}getBoundingBox(){let t=this.getRawBoundingBoxes();return t.length>0&&s(t[0])?t[0]:null}getBoundingBoxes(){let t=this.getRawBoundingBoxes();return 1===t.length&&s(t[0])?t:t.length>1?t.filter(((t,e)=>e>0&&s(t))):[]}getRawBoundingBoxes(){let t=this.extent?.spatial?.bbox;return Array.isArray(t)&&t.length>0?t:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=this.extent?.temporal?.interval;return Array.isArray(t)&&t.length>0?t.filter((t=>Array.isArray(t)&&(u(t[0])||u(t[1])))).map((t=>t.map((t=>v(t))))):[]}getSummary(t){return this.summaries[t]}getBands(){let t=[this.getSummary("eo:bands"),this.getSummary("raster:bands")].filter((t=>Array.isArray(t)));return t.length>=2?o(...t):1===t.length?t[0]:[]}}class O extends B{constructor(t,e=null){super(t,e,{collections:t=>t.map((t=>new C(t)))})}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map((t=>t.toGeoJSON())).filter((t=>null!==t))}}getBoundingBox(){return l(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map((t=>t.getBoundingBox()))}getTemporalExtent(){return _(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map((t=>t.getTemporalExtent()))}}class S extends T{constructor(t,e=null){super(t,e,{assets:k.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return s(this.bbox)?this.bbox:null}getBoundingBoxes(){return s(this.bbox)?[this.bbox]:[]}getDateTime(){let t=v(this.properties.datetime);if(!t){let t=v(this.properties.start_datetime),e=v(this.properties.end_datetime);return t&&e?function(t,e){return new Date(t.valueOf()+(e-t)/2)}(t,e):t||e}return t}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=[];return u(this.properties.start_datetime)||u(this.properties.end_datetime)?t=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:u(this.properties.datetime)&&(t=[[this.properties.datetime,this.properties.datetime]]),t.map((t=>t.map((t=>v(t)))))}getMetadata(t){return this.properties[t]}getBands(){let t=this.getMetadata("eo:bands");return Array.isArray(t)?t:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class R extends B{constructor(t,e=null){super(t,e,{features:t=>t.map((t=>new S(t)))})}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return l(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map((t=>t.getBoundingBox()))}getTemporalExtent(){return _(this.getTemporalExtents())}getTemporalExtents(){return this.features.map((t=>t.getTemporalExtent()))}}function W(e,r=!0,n=!1){return r&&(e=t.stac(e,n)),"Feature"===e.type?new S(e):"FeatureCollection"===e.type?new R(e):"Collection"===e.type||!e.type&&void 0!==e.extent&&void 0!==e.license?new C(e):!e.type&&Array.isArray(e.collections)?new O(e):new L(e)}export{B as APICollection,k as Asset,L as Catalog,w as CatalogLike,C as Collection,O as CollectionCollection,S as Item,R as ItemCollection,A as Link,T as STAC,b as STACHypermedia,h as STACObject,x as STACReference,W as default};
