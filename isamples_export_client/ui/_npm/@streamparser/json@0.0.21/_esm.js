/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@streamparser/json@0.0.21/dist/mjs/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t;!function(t){t[t.BACKSPACE=8]="BACKSPACE",t[t.FORM_FEED=12]="FORM_FEED",t[t.NEWLINE=10]="NEWLINE",t[t.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",t[t.TAB=9]="TAB",t[t.SPACE=32]="SPACE",t[t.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",t[t.QUOTATION_MARK=34]="QUOTATION_MARK",t[t.NUMBER_SIGN=35]="NUMBER_SIGN",t[t.DOLLAR_SIGN=36]="DOLLAR_SIGN",t[t.PERCENT_SIGN=37]="PERCENT_SIGN",t[t.AMPERSAND=38]="AMPERSAND",t[t.APOSTROPHE=39]="APOSTROPHE",t[t.LEFT_PARENTHESIS=40]="LEFT_PARENTHESIS",t[t.RIGHT_PARENTHESIS=41]="RIGHT_PARENTHESIS",t[t.ASTERISK=42]="ASTERISK",t[t.PLUS_SIGN=43]="PLUS_SIGN",t[t.COMMA=44]="COMMA",t[t.HYPHEN_MINUS=45]="HYPHEN_MINUS",t[t.FULL_STOP=46]="FULL_STOP",t[t.SOLIDUS=47]="SOLIDUS",t[t.DIGIT_ZERO=48]="DIGIT_ZERO",t[t.DIGIT_ONE=49]="DIGIT_ONE",t[t.DIGIT_TWO=50]="DIGIT_TWO",t[t.DIGIT_THREE=51]="DIGIT_THREE",t[t.DIGIT_FOUR=52]="DIGIT_FOUR",t[t.DIGIT_FIVE=53]="DIGIT_FIVE",t[t.DIGIT_SIX=54]="DIGIT_SIX",t[t.DIGIT_SEVEN=55]="DIGIT_SEVEN",t[t.DIGIT_EIGHT=56]="DIGIT_EIGHT",t[t.DIGIT_NINE=57]="DIGIT_NINE",t[t.COLON=58]="COLON",t[t.SEMICOLON=59]="SEMICOLON",t[t.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",t[t.EQUALS_SIGN=61]="EQUALS_SIGN",t[t.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",t[t.QUESTION_MARK=63]="QUESTION_MARK",t[t.COMMERCIAL_AT=64]="COMMERCIAL_AT",t[t.LATIN_CAPITAL_LETTER_A=65]="LATIN_CAPITAL_LETTER_A",t[t.LATIN_CAPITAL_LETTER_B=66]="LATIN_CAPITAL_LETTER_B",t[t.LATIN_CAPITAL_LETTER_C=67]="LATIN_CAPITAL_LETTER_C",t[t.LATIN_CAPITAL_LETTER_D=68]="LATIN_CAPITAL_LETTER_D",t[t.LATIN_CAPITAL_LETTER_E=69]="LATIN_CAPITAL_LETTER_E",t[t.LATIN_CAPITAL_LETTER_F=70]="LATIN_CAPITAL_LETTER_F",t[t.LATIN_CAPITAL_LETTER_G=71]="LATIN_CAPITAL_LETTER_G",t[t.LATIN_CAPITAL_LETTER_H=72]="LATIN_CAPITAL_LETTER_H",t[t.LATIN_CAPITAL_LETTER_I=73]="LATIN_CAPITAL_LETTER_I",t[t.LATIN_CAPITAL_LETTER_J=74]="LATIN_CAPITAL_LETTER_J",t[t.LATIN_CAPITAL_LETTER_K=75]="LATIN_CAPITAL_LETTER_K",t[t.LATIN_CAPITAL_LETTER_L=76]="LATIN_CAPITAL_LETTER_L",t[t.LATIN_CAPITAL_LETTER_M=77]="LATIN_CAPITAL_LETTER_M",t[t.LATIN_CAPITAL_LETTER_N=78]="LATIN_CAPITAL_LETTER_N",t[t.LATIN_CAPITAL_LETTER_O=79]="LATIN_CAPITAL_LETTER_O",t[t.LATIN_CAPITAL_LETTER_P=80]="LATIN_CAPITAL_LETTER_P",t[t.LATIN_CAPITAL_LETTER_Q=81]="LATIN_CAPITAL_LETTER_Q",t[t.LATIN_CAPITAL_LETTER_R=82]="LATIN_CAPITAL_LETTER_R",t[t.LATIN_CAPITAL_LETTER_S=83]="LATIN_CAPITAL_LETTER_S",t[t.LATIN_CAPITAL_LETTER_T=84]="LATIN_CAPITAL_LETTER_T",t[t.LATIN_CAPITAL_LETTER_U=85]="LATIN_CAPITAL_LETTER_U",t[t.LATIN_CAPITAL_LETTER_V=86]="LATIN_CAPITAL_LETTER_V",t[t.LATIN_CAPITAL_LETTER_W=87]="LATIN_CAPITAL_LETTER_W",t[t.LATIN_CAPITAL_LETTER_X=88]="LATIN_CAPITAL_LETTER_X",t[t.LATIN_CAPITAL_LETTER_Y=89]="LATIN_CAPITAL_LETTER_Y",t[t.LATIN_CAPITAL_LETTER_Z=90]="LATIN_CAPITAL_LETTER_Z",t[t.LEFT_SQUARE_BRACKET=91]="LEFT_SQUARE_BRACKET",t[t.REVERSE_SOLIDUS=92]="REVERSE_SOLIDUS",t[t.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",t[t.CIRCUMFLEX_ACCENT=94]="CIRCUMFLEX_ACCENT",t[t.LOW_LINE=95]="LOW_LINE",t[t.GRAVE_ACCENT=96]="GRAVE_ACCENT",t[t.LATIN_SMALL_LETTER_A=97]="LATIN_SMALL_LETTER_A",t[t.LATIN_SMALL_LETTER_B=98]="LATIN_SMALL_LETTER_B",t[t.LATIN_SMALL_LETTER_C=99]="LATIN_SMALL_LETTER_C",t[t.LATIN_SMALL_LETTER_D=100]="LATIN_SMALL_LETTER_D",t[t.LATIN_SMALL_LETTER_E=101]="LATIN_SMALL_LETTER_E",t[t.LATIN_SMALL_LETTER_F=102]="LATIN_SMALL_LETTER_F",t[t.LATIN_SMALL_LETTER_G=103]="LATIN_SMALL_LETTER_G",t[t.LATIN_SMALL_LETTER_H=104]="LATIN_SMALL_LETTER_H",t[t.LATIN_SMALL_LETTER_I=105]="LATIN_SMALL_LETTER_I",t[t.LATIN_SMALL_LETTER_J=106]="LATIN_SMALL_LETTER_J",t[t.LATIN_SMALL_LETTER_K=107]="LATIN_SMALL_LETTER_K",t[t.LATIN_SMALL_LETTER_L=108]="LATIN_SMALL_LETTER_L",t[t.LATIN_SMALL_LETTER_M=109]="LATIN_SMALL_LETTER_M",t[t.LATIN_SMALL_LETTER_N=110]="LATIN_SMALL_LETTER_N",t[t.LATIN_SMALL_LETTER_O=111]="LATIN_SMALL_LETTER_O",t[t.LATIN_SMALL_LETTER_P=112]="LATIN_SMALL_LETTER_P",t[t.LATIN_SMALL_LETTER_Q=113]="LATIN_SMALL_LETTER_Q",t[t.LATIN_SMALL_LETTER_R=114]="LATIN_SMALL_LETTER_R",t[t.LATIN_SMALL_LETTER_S=115]="LATIN_SMALL_LETTER_S",t[t.LATIN_SMALL_LETTER_T=116]="LATIN_SMALL_LETTER_T",t[t.LATIN_SMALL_LETTER_U=117]="LATIN_SMALL_LETTER_U",t[t.LATIN_SMALL_LETTER_V=118]="LATIN_SMALL_LETTER_V",t[t.LATIN_SMALL_LETTER_W=119]="LATIN_SMALL_LETTER_W",t[t.LATIN_SMALL_LETTER_X=120]="LATIN_SMALL_LETTER_X",t[t.LATIN_SMALL_LETTER_Y=121]="LATIN_SMALL_LETTER_Y",t[t.LATIN_SMALL_LETTER_Z=122]="LATIN_SMALL_LETTER_Z",t[t.LEFT_CURLY_BRACKET=123]="LEFT_CURLY_BRACKET",t[t.VERTICAL_LINE=124]="VERTICAL_LINE",t[t.RIGHT_CURLY_BRACKET=125]="RIGHT_CURLY_BRACKET",t[t.TILDE=126]="TILDE"}(t||(t={}));const e={[t.QUOTATION_MARK]:t.QUOTATION_MARK,[t.REVERSE_SOLIDUS]:t.REVERSE_SOLIDUS,[t.SOLIDUS]:t.SOLIDUS,[t.LATIN_SMALL_LETTER_B]:t.BACKSPACE,[t.LATIN_SMALL_LETTER_F]:t.FORM_FEED,[t.LATIN_SMALL_LETTER_N]:t.NEWLINE,[t.LATIN_SMALL_LETTER_R]:t.CARRIAGE_RETURN,[t.LATIN_SMALL_LETTER_T]:t.TAB};var T,s=Object.freeze({__proto__:null,get charset(){return t},escapedSequences:e});class _{constructor(){this.decoder=new TextDecoder("utf-8"),this.strings=[],this.byteLength=0}appendChar(t){this.strings.push(String.fromCharCode(t)),this.byteLength+=1}appendBuf(t,e=0,T=t.length){this.strings.push(this.decoder.decode(t.subarray(e,T))),this.byteLength+=T-e}reset(){this.strings=[],this.byteLength=0}toString(){return this.strings.join("")}}class E{constructor(t){this.decoder=new TextDecoder("utf-8"),this.bufferOffset=0,this.string="",this.byteLength=0,this.buffer=new Uint8Array(t)}appendChar(t){this.bufferOffset>=this.buffer.length&&this.flushStringBuffer(),this.buffer[this.bufferOffset++]=t,this.byteLength+=1}appendBuf(t,e=0,T=t.length){const s=T-e;this.bufferOffset+s>this.buffer.length&&this.flushStringBuffer(),this.buffer.set(t.subarray(e,T),this.bufferOffset),this.bufferOffset+=s,this.byteLength+=s}flushStringBuffer(){this.string+=this.decoder.decode(this.buffer.subarray(0,this.bufferOffset)),this.bufferOffset=0}reset(){this.string="",this.bufferOffset=0,this.byteLength=0}toString(){return this.flushStringBuffer(),this.string}}!function(t){t[t.LEFT_BRACE=0]="LEFT_BRACE",t[t.RIGHT_BRACE=1]="RIGHT_BRACE",t[t.LEFT_BRACKET=2]="LEFT_BRACKET",t[t.RIGHT_BRACKET=3]="RIGHT_BRACKET",t[t.COLON=4]="COLON",t[t.COMMA=5]="COMMA",t[t.TRUE=6]="TRUE",t[t.FALSE=7]="FALSE",t[t.NULL=8]="NULL",t[t.STRING=9]="STRING",t[t.NUMBER=10]="NUMBER",t[t.SEPARATOR=11]="SEPARATOR"}(T||(T={}));var i,L=T;function A(t){return["START","ENDED","ERROR","TRUE1","TRUE2","TRUE3","FALSE1","FALSE2","FALSE3","FALSE4","NULL1","NULL2","NULL3","STRING_DEFAULT","STRING_AFTER_BACKSLASH","STRING_UNICODE_DIGIT_1","STRING_UNICODE_DIGIT_2","STRING_UNICODE_DIGIT_3","STRING_UNICODE_DIGIT_4","STRING_INCOMPLETE_CHAR","NUMBER_AFTER_INITIAL_MINUS","NUMBER_AFTER_INITIAL_ZERO","NUMBER_AFTER_INITIAL_NON_ZERO","NUMBER_AFTER_FULL_STOP","NUMBER_AFTER_DECIMAL","NUMBER_AFTER_E","NUMBER_AFTER_E_AND_SIGN","NUMBER_AFTER_E_AND_DIGIT","SEPARATOR","BOM_OR_START","BOM"][t]}!function(t){t[t.START=0]="START",t[t.ENDED=1]="ENDED",t[t.ERROR=2]="ERROR",t[t.TRUE1=3]="TRUE1",t[t.TRUE2=4]="TRUE2",t[t.TRUE3=5]="TRUE3",t[t.FALSE1=6]="FALSE1",t[t.FALSE2=7]="FALSE2",t[t.FALSE3=8]="FALSE3",t[t.FALSE4=9]="FALSE4",t[t.NULL1=10]="NULL1",t[t.NULL2=11]="NULL2",t[t.NULL3=12]="NULL3",t[t.STRING_DEFAULT=13]="STRING_DEFAULT",t[t.STRING_AFTER_BACKSLASH=14]="STRING_AFTER_BACKSLASH",t[t.STRING_UNICODE_DIGIT_1=15]="STRING_UNICODE_DIGIT_1",t[t.STRING_UNICODE_DIGIT_2=16]="STRING_UNICODE_DIGIT_2",t[t.STRING_UNICODE_DIGIT_3=17]="STRING_UNICODE_DIGIT_3",t[t.STRING_UNICODE_DIGIT_4=18]="STRING_UNICODE_DIGIT_4",t[t.STRING_INCOMPLETE_CHAR=19]="STRING_INCOMPLETE_CHAR",t[t.NUMBER_AFTER_INITIAL_MINUS=20]="NUMBER_AFTER_INITIAL_MINUS",t[t.NUMBER_AFTER_INITIAL_ZERO=21]="NUMBER_AFTER_INITIAL_ZERO",t[t.NUMBER_AFTER_INITIAL_NON_ZERO=22]="NUMBER_AFTER_INITIAL_NON_ZERO",t[t.NUMBER_AFTER_FULL_STOP=23]="NUMBER_AFTER_FULL_STOP",t[t.NUMBER_AFTER_DECIMAL=24]="NUMBER_AFTER_DECIMAL",t[t.NUMBER_AFTER_E=25]="NUMBER_AFTER_E",t[t.NUMBER_AFTER_E_AND_SIGN=26]="NUMBER_AFTER_E_AND_SIGN",t[t.NUMBER_AFTER_E_AND_DIGIT=27]="NUMBER_AFTER_E_AND_DIGIT",t[t.SEPARATOR=28]="SEPARATOR",t[t.BOM_OR_START=29]="BOM_OR_START",t[t.BOM=30]="BOM"}(i||(i={}));const R={stringBufferSize:0,numberBufferSize:0,separator:void 0,emitPartialTokens:!1};class r extends Error{constructor(t){super(t),Object.setPrototypeOf(this,r.prototype)}}class I{constructor(t){this.state=i.BOM_OR_START,this.bomIndex=0,this.separatorIndex=0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.char_split_buffer=new Uint8Array(4),this.encoder=new TextEncoder,this.offset=-1,t=Object.assign(Object.assign({},R),t),this.emitPartialTokens=!0===t.emitPartialTokens,this.bufferedString=t.stringBufferSize&&t.stringBufferSize>4?new E(t.stringBufferSize):new _,this.bufferedNumber=t.numberBufferSize&&t.numberBufferSize>0?new E(t.numberBufferSize):new _,this.separator=t.separator,this.separatorBytes=t.separator?this.encoder.encode(t.separator):void 0}get isEnded(){return this.state===i.ENDED}write(T){try{let s;if(T instanceof Uint8Array)s=T;else if("string"==typeof T)s=this.encoder.encode(T);else if(Array.isArray(T))s=Uint8Array.from(T);else{if(!ArrayBuffer.isView(T))throw new TypeError("Unexpected type. The `write` function only accepts Arrays, TypedArrays and Strings.");s=new Uint8Array(T.buffer,T.byteOffset,T.byteLength)}for(let _=0;_<s.length;_+=1){const E=s[_];switch(this.state){case i.BOM_OR_START:if(T instanceof Uint8Array&&239===E){this.bom=[239,187,191],this.bomIndex+=1,this.state=i.BOM;continue}if(T instanceof Uint16Array){if(254===E){this.bom=[254,255],this.bomIndex+=1,this.state=i.BOM;continue}if(255===E){this.bom=[255,254],this.bomIndex+=1,this.state=i.BOM;continue}}if(T instanceof Uint32Array){if(0===E){this.bom=[0,0,254,255],this.bomIndex+=1,this.state=i.BOM;continue}if(255===E){this.bom=[255,254,0,0],this.bomIndex+=1,this.state=i.BOM;continue}}case i.START:if(this.offset+=1,this.separatorBytes&&E===this.separatorBytes[0]){if(1===this.separatorBytes.length){this.state=i.START,this.onToken({token:L.SEPARATOR,value:this.separator,offset:this.offset+this.separatorBytes.length-1});continue}this.state=i.SEPARATOR;continue}if(E===t.SPACE||E===t.NEWLINE||E===t.CARRIAGE_RETURN||E===t.TAB)continue;if(E===t.LEFT_CURLY_BRACKET){this.onToken({token:L.LEFT_BRACE,value:"{",offset:this.offset});continue}if(E===t.RIGHT_CURLY_BRACKET){this.onToken({token:L.RIGHT_BRACE,value:"}",offset:this.offset});continue}if(E===t.LEFT_SQUARE_BRACKET){this.onToken({token:L.LEFT_BRACKET,value:"[",offset:this.offset});continue}if(E===t.RIGHT_SQUARE_BRACKET){this.onToken({token:L.RIGHT_BRACKET,value:"]",offset:this.offset});continue}if(E===t.COLON){this.onToken({token:L.COLON,value:":",offset:this.offset});continue}if(E===t.COMMA){this.onToken({token:L.COMMA,value:",",offset:this.offset});continue}if(E===t.LATIN_SMALL_LETTER_T){this.state=i.TRUE1;continue}if(E===t.LATIN_SMALL_LETTER_F){this.state=i.FALSE1;continue}if(E===t.LATIN_SMALL_LETTER_N){this.state=i.NULL1;continue}if(E===t.QUOTATION_MARK){this.bufferedString.reset(),this.state=i.STRING_DEFAULT;continue}if(E>=t.DIGIT_ONE&&E<=t.DIGIT_NINE){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_INITIAL_NON_ZERO;continue}if(E===t.DIGIT_ZERO){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_INITIAL_ZERO;continue}if(E===t.HYPHEN_MINUS){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_INITIAL_MINUS;continue}break;case i.STRING_DEFAULT:if(E===t.QUOTATION_MARK){const t=this.bufferedString.toString();this.state=i.START,this.onToken({token:L.STRING,value:t,offset:this.offset}),this.offset+=this.bufferedString.byteLength+1;continue}if(E===t.REVERSE_SOLIDUS){this.state=i.STRING_AFTER_BACKSLASH;continue}if(E>=128){if(this.bytes_in_sequence=E>=194&&E<=223?2:E<=239?3:4,this.bytes_in_sequence<=s.length-_){this.bufferedString.appendBuf(s,_,_+this.bytes_in_sequence),_+=this.bytes_in_sequence-1;continue}this.bytes_remaining=_+this.bytes_in_sequence-s.length,this.char_split_buffer.set(s.subarray(_)),_=s.length-1,this.state=i.STRING_INCOMPLETE_CHAR;continue}if(E>=t.SPACE){this.bufferedString.appendChar(E);continue}break;case i.STRING_INCOMPLETE_CHAR:this.char_split_buffer.set(s.subarray(_,_+this.bytes_remaining),this.bytes_in_sequence-this.bytes_remaining),this.bufferedString.appendBuf(this.char_split_buffer,0,this.bytes_in_sequence),_=this.bytes_remaining-1,this.state=i.STRING_DEFAULT;continue;case i.STRING_AFTER_BACKSLASH:const A=e[E];if(A){this.bufferedString.appendChar(A),this.state=i.STRING_DEFAULT;continue}if(E===t.LATIN_SMALL_LETTER_U){this.unicode="",this.state=i.STRING_UNICODE_DIGIT_1;continue}break;case i.STRING_UNICODE_DIGIT_1:case i.STRING_UNICODE_DIGIT_2:case i.STRING_UNICODE_DIGIT_3:if(E>=t.DIGIT_ZERO&&E<=t.DIGIT_NINE||E>=t.LATIN_CAPITAL_LETTER_A&&E<=t.LATIN_CAPITAL_LETTER_F||E>=t.LATIN_SMALL_LETTER_A&&E<=t.LATIN_SMALL_LETTER_F){this.unicode+=String.fromCharCode(E),this.state+=1;continue}break;case i.STRING_UNICODE_DIGIT_4:if(E>=t.DIGIT_ZERO&&E<=t.DIGIT_NINE||E>=t.LATIN_CAPITAL_LETTER_A&&E<=t.LATIN_CAPITAL_LETTER_F||E>=t.LATIN_SMALL_LETTER_A&&E<=t.LATIN_SMALL_LETTER_F){const t=parseInt(this.unicode+String.fromCharCode(E),16);void 0===this.highSurrogate?t>=55296&&t<=56319?this.highSurrogate=t:this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(t))):(t>=56320&&t<=57343?this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(this.highSurrogate,t))):this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(this.highSurrogate))),this.highSurrogate=void 0),this.state=i.STRING_DEFAULT;continue}break;case i.NUMBER_AFTER_INITIAL_MINUS:if(E===t.DIGIT_ZERO){this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_INITIAL_ZERO;continue}if(E>=t.DIGIT_ONE&&E<=t.DIGIT_NINE){this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_INITIAL_NON_ZERO;continue}break;case i.NUMBER_AFTER_INITIAL_ZERO:if(E===t.FULL_STOP){this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_FULL_STOP;continue}if(E===t.LATIN_SMALL_LETTER_E||E===t.LATIN_CAPITAL_LETTER_E){this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_E;continue}_-=1,this.state=i.START,this.emitNumber();continue;case i.NUMBER_AFTER_INITIAL_NON_ZERO:if(E>=t.DIGIT_ZERO&&E<=t.DIGIT_NINE){this.bufferedNumber.appendChar(E);continue}if(E===t.FULL_STOP){this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_FULL_STOP;continue}if(E===t.LATIN_SMALL_LETTER_E||E===t.LATIN_CAPITAL_LETTER_E){this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_E;continue}_-=1,this.state=i.START,this.emitNumber();continue;case i.NUMBER_AFTER_FULL_STOP:if(E>=t.DIGIT_ZERO&&E<=t.DIGIT_NINE){this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_DECIMAL;continue}break;case i.NUMBER_AFTER_DECIMAL:if(E>=t.DIGIT_ZERO&&E<=t.DIGIT_NINE){this.bufferedNumber.appendChar(E);continue}if(E===t.LATIN_SMALL_LETTER_E||E===t.LATIN_CAPITAL_LETTER_E){this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_E;continue}_-=1,this.state=i.START,this.emitNumber();continue;case i.NUMBER_AFTER_E:if(E===t.PLUS_SIGN||E===t.HYPHEN_MINUS){this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_E_AND_SIGN;continue}case i.NUMBER_AFTER_E_AND_SIGN:if(E>=t.DIGIT_ZERO&&E<=t.DIGIT_NINE){this.bufferedNumber.appendChar(E),this.state=i.NUMBER_AFTER_E_AND_DIGIT;continue}break;case i.NUMBER_AFTER_E_AND_DIGIT:if(E>=t.DIGIT_ZERO&&E<=t.DIGIT_NINE){this.bufferedNumber.appendChar(E);continue}_-=1,this.state=i.START,this.emitNumber();continue;case i.TRUE1:if(E===t.LATIN_SMALL_LETTER_R){this.state=i.TRUE2;continue}break;case i.TRUE2:if(E===t.LATIN_SMALL_LETTER_U){this.state=i.TRUE3;continue}break;case i.TRUE3:if(E===t.LATIN_SMALL_LETTER_E){this.state=i.START,this.onToken({token:L.TRUE,value:!0,offset:this.offset}),this.offset+=3;continue}break;case i.FALSE1:if(E===t.LATIN_SMALL_LETTER_A){this.state=i.FALSE2;continue}break;case i.FALSE2:if(E===t.LATIN_SMALL_LETTER_L){this.state=i.FALSE3;continue}break;case i.FALSE3:if(E===t.LATIN_SMALL_LETTER_S){this.state=i.FALSE4;continue}break;case i.FALSE4:if(E===t.LATIN_SMALL_LETTER_E){this.state=i.START,this.onToken({token:L.FALSE,value:!1,offset:this.offset}),this.offset+=4;continue}break;case i.NULL1:if(E===t.LATIN_SMALL_LETTER_U){this.state=i.NULL2;continue}break;case i.NULL2:if(E===t.LATIN_SMALL_LETTER_L){this.state=i.NULL3;continue}break;case i.NULL3:if(E===t.LATIN_SMALL_LETTER_L){this.state=i.START,this.onToken({token:L.NULL,value:null,offset:this.offset}),this.offset+=3;continue}break;case i.SEPARATOR:if(this.separatorIndex+=1,!this.separatorBytes||E!==this.separatorBytes[this.separatorIndex])break;this.separatorIndex===this.separatorBytes.length-1&&(this.state=i.START,this.onToken({token:L.SEPARATOR,value:this.separator,offset:this.offset+this.separatorIndex}),this.separatorIndex=0);continue;case i.BOM:if(E===this.bom[this.bomIndex]){if(this.bomIndex===this.bom.length-1){this.state=i.START,this.bom=void 0,this.bomIndex=0;continue}this.bomIndex+=1;continue}break;case i.ENDED:if(E===t.SPACE||E===t.NEWLINE||E===t.CARRIAGE_RETURN||E===t.TAB)continue}throw new r(`Unexpected "${String.fromCharCode(E)}" at position "${_}" in state ${A(this.state)}`)}if(this.emitPartialTokens)switch(this.state){case i.TRUE1:case i.TRUE2:case i.TRUE3:this.onToken({token:L.TRUE,value:!0,offset:this.offset,partial:!0});break;case i.FALSE1:case i.FALSE2:case i.FALSE3:case i.FALSE4:this.onToken({token:L.FALSE,value:!1,offset:this.offset,partial:!0});break;case i.NULL1:case i.NULL2:case i.NULL3:this.onToken({token:L.NULL,value:null,offset:this.offset,partial:!0});break;case i.STRING_DEFAULT:{const t=this.bufferedString.toString();this.onToken({token:L.STRING,value:t,offset:this.offset,partial:!0});break}case i.NUMBER_AFTER_INITIAL_ZERO:case i.NUMBER_AFTER_INITIAL_NON_ZERO:case i.NUMBER_AFTER_DECIMAL:case i.NUMBER_AFTER_E_AND_DIGIT:try{this.onToken({token:L.NUMBER,value:this.parseNumber(this.bufferedNumber.toString()),offset:this.offset,partial:!0})}catch(t){}}}catch(t){this.error(t)}}emitNumber(){this.onToken({token:L.NUMBER,value:this.parseNumber(this.bufferedNumber.toString()),offset:this.offset}),this.offset+=this.bufferedNumber.byteLength-1}parseNumber(t){return Number(t)}error(t){this.state!==i.ENDED&&(this.state=i.ERROR),this.onError(t)}end(){switch(this.state){case i.NUMBER_AFTER_INITIAL_ZERO:case i.NUMBER_AFTER_INITIAL_NON_ZERO:case i.NUMBER_AFTER_DECIMAL:case i.NUMBER_AFTER_E_AND_DIGIT:this.state=i.ENDED,this.emitNumber(),this.onEnd();break;case i.BOM_OR_START:case i.START:case i.ERROR:case i.SEPARATOR:this.state=i.ENDED,this.onEnd();break;default:this.error(new r(`Tokenizer ended in the middle of a token (state: ${A(this.state)}). Either not all the data was received or the data was invalid.`))}}onToken(t){throw new r('Can\'t emit tokens before the "onToken" callback has been set up.')}onError(t){throw t}onEnd(){}}var n,h;function a(t){return["VALUE","KEY","COLON","COMMA","ENDED","ERROR","SEPARATOR"][t]}!function(t){t[t.OBJECT=0]="OBJECT",t[t.ARRAY=1]="ARRAY"}(n||(n={})),function(t){t[t.VALUE=0]="VALUE",t[t.KEY=1]="KEY",t[t.COLON=2]="COLON",t[t.COMMA=3]="COMMA",t[t.ENDED=4]="ENDED",t[t.ERROR=5]="ERROR",t[t.SEPARATOR=6]="SEPARATOR"}(h||(h={}));const N={paths:void 0,keepStack:!0,separator:void 0,emitPartialValues:!1};class o extends Error{constructor(t){super(t),Object.setPrototypeOf(this,o.prototype)}}class f{constructor(t){this.state=h.VALUE,this.mode=void 0,this.key=void 0,this.value=void 0,this.stack=[],(t=Object.assign(Object.assign({},N),t)).paths&&(this.paths=t.paths.map((t=>{if(void 0===t||"$*"===t)return;if(!t.startsWith("$"))throw new o(`Invalid selector "${t}". Should start with "$".`);const e=t.split(".").slice(1);if(e.includes(""))throw new o(`Invalid selector "${t}". ".." syntax not supported.`);return e}))),this.keepStack=t.keepStack||!1,this.separator=t.separator,t.emitPartialValues||(this.emitPartial=()=>{})}shouldEmit(){return!this.paths||this.paths.some((t=>{var e;if(void 0===t)return!0;if(t.length!==this.stack.length)return!1;for(let e=0;e<t.length-1;e++){const T=t[e],s=this.stack[e+1].key;if("*"!==T&&T!==s)return!1}const T=t[t.length-1];return"*"===T||T===(null===(e=this.key)||void 0===e?void 0:e.toString())}))}push(){this.stack.push({key:this.key,value:this.value,mode:this.mode,emit:this.shouldEmit()})}pop(){const t=this.value;let e;({key:this.key,value:this.value,mode:this.mode,emit:e}=this.stack.pop()),this.state=void 0!==this.mode?h.COMMA:h.VALUE,this.emit(t,e)}emit(t,e){!this.keepStack&&this.value&&this.stack.every((t=>!t.emit))&&delete this.value[this.key],e&&this.onValue({value:t,key:this.key,parent:this.value,stack:this.stack}),0===this.stack.length&&(this.separator?this.state=h.SEPARATOR:void 0===this.separator&&this.end())}emitPartial(t){this.shouldEmit()&&(this.state!==h.KEY?this.onValue({value:t,key:this.key,parent:this.value,stack:this.stack,partial:!0}):this.onValue({value:void 0,key:t,parent:this.value,stack:this.stack,partial:!0}))}get isEnded(){return this.state===h.ENDED}write({token:e,value:T,partial:s}){try{if(s)return void this.emitPartial(T);if(this.state===h.VALUE){if(e===L.STRING||e===L.NUMBER||e===L.TRUE||e===L.FALSE||e===L.NULL)return this.mode===n.OBJECT?(this.value[this.key]=T,this.state=h.COMMA):this.mode===n.ARRAY&&(this.value.push(T),this.state=h.COMMA),void this.emit(T,this.shouldEmit());if(e===L.LEFT_BRACE){if(this.push(),this.mode===n.OBJECT)this.value=this.value[this.key]={};else if(this.mode===n.ARRAY){const t={};this.value.push(t),this.value=t}else this.value={};return this.mode=n.OBJECT,this.state=h.KEY,this.key=void 0,void this.emitPartial()}if(e===L.LEFT_BRACKET){if(this.push(),this.mode===n.OBJECT)this.value=this.value[this.key]=[];else if(this.mode===n.ARRAY){const t=[];this.value.push(t),this.value=t}else this.value=[];return this.mode=n.ARRAY,this.state=h.VALUE,this.key=0,void this.emitPartial()}if(this.mode===n.ARRAY&&e===L.RIGHT_BRACKET&&0===this.value.length)return void this.pop()}if(this.state===h.KEY){if(e===L.STRING)return this.key=T,this.state=h.COLON,void this.emitPartial();if(e===L.RIGHT_BRACE&&0===Object.keys(this.value).length)return void this.pop()}if(this.state===h.COLON&&e===L.COLON)return void(this.state=h.VALUE);if(this.state===h.COMMA){if(e===L.COMMA){if(this.mode===n.ARRAY)return this.state=h.VALUE,void(this.key+=1);if(this.mode===n.OBJECT)return void(this.state=h.KEY)}if(e===L.RIGHT_BRACE&&this.mode===n.OBJECT||e===L.RIGHT_BRACKET&&this.mode===n.ARRAY)return void this.pop()}if(this.state===h.SEPARATOR&&e===L.SEPARATOR&&T===this.separator)return void(this.state=h.VALUE);if(e===L.SEPARATOR&&this.state!==h.SEPARATOR&&Array.from(T).map((t=>t.charCodeAt(0))).every((e=>e===t.SPACE||e===t.NEWLINE||e===t.CARRIAGE_RETURN||e===t.TAB)))return;throw new o(`Unexpected ${L[e]} (${JSON.stringify(T)}) in state ${a(this.state)}`)}catch(t){this.error(t)}}error(t){this.state!==h.ENDED&&(this.state=h.ERROR),this.onError(t)}end(){this.state!==h.VALUE&&this.state!==h.SEPARATOR||this.stack.length>0?this.error(new Error(`Parser ended in mid-parsing (state: ${a(this.state)}). Either not all the data was received or the data was invalid.`)):(this.state=h.ENDED,this.onEnd())}onValue(t){throw new o('Can\'t emit data before the "onValue" callback has been set up.')}onError(t){throw t}onEnd(){}}class S{constructor(t={}){this.tokenizer=new I(t),this.tokenParser=new f(t),this.tokenizer.onToken=this.tokenParser.write.bind(this.tokenParser),this.tokenizer.onEnd=()=>{this.tokenParser.isEnded||this.tokenParser.end()},this.tokenParser.onError=this.tokenizer.error.bind(this.tokenizer),this.tokenParser.onEnd=()=>{this.tokenizer.isEnded||this.tokenizer.end()}}get isEnded(){return this.tokenizer.isEnded&&this.tokenParser.isEnded}write(t){this.tokenizer.write(t)}end(){this.tokenizer.end()}set onToken(t){this.tokenizer.onToken=e=>{t(e),this.tokenParser.write(e)}}set onValue(t){this.tokenParser.onValue=t}set onError(t){this.tokenizer.onError=t}set onEnd(t){this.tokenParser.onEnd=()=>{this.tokenizer.isEnded||this.tokenizer.end(),t.call(this.tokenParser)}}}var u=Object.freeze({__proto__:null}),c=Object.freeze({__proto__:null}),C=Object.freeze({__proto__:null});export{S as JSONParser,u as JsonTypes,C as ParsedElementInfo,c as ParsedTokenInfo,f as TokenParser,o as TokenParserError,n as TokenParserMode,L as TokenType,I as Tokenizer,r as TokenizerError,s as utf8};export default null;
