<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Proof of concept - Query iSB using Observable Framework | iSamples Viewer</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_import/isclib.e38a39a7.js">
<link rel="modulepreload" href="./_npm/@streamparser/json@0.0.21/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.js";

define({id: "d24d9d21", inputs: ["view","Inputs"], outputs: ["iSC","isamples","query"], body: async (view,Inputs) => {
const {iSC} = await import("./_import/isclib.e38a39a7.js");

const isamples = new iSC();

const query = view(Inputs.textarea({
    label: "Query",
    value: "*:*",
    submit: true
}));
return {iSC,isamples,query};
}});

define({id: "a8b77192", inline: true, inputs: ["query","display"], body: async (query,display) => {
display(await(
query
))
}});

define({id: "2346b82f", inputs: ["Mutable","dispatchEvent","Event","Generators","addEventListener","removeEventListener","isamples"], outputs: ["nRecords","nrows","buffer_data","bufferPush","buffer","timeout","sleep","pointStream","fakeQuery","dependsFakeQuery"], body: (Mutable,dispatchEvent,Event,Generators,addEventListener,removeEventListener,isamples) => {
const nRecords = Mutable(0);
const nrows = Mutable(0);
const buffer_data = {"b":[]};
const bufferPush = (r) => {
    buffer_data.b.push(r);
    dispatchEvent(new Event("bufferchange"));
}

const buffer = Generators.observe((change) => {
   const changed = () => change(buffer_data);
   addEventListener("bufferchange", changed);
   changed();
   return () => removeEventListener("bufferchange", changed);
});

function timeout(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

async function sleep(duration, fn, ...args) {
    await timeout(duration);
    return fn(...args);
}

async function pointStream(q) {
    const handler = async function (v) {
        console.log(v);
    }
    const yielder = function* yielder(h) {
        
    }
    await isamples.pointStreamGenerator(q, handler)
}

async function fakeQuery(q) {
    const qv = q;
    nRecords.value = isamples.countRecords(qv);
    const row = {"query": qv, "typeof":typeof(qv)};
    bufferPush(row);
    pointStream(qv);
    return [row];    
}

async function dependsFakeQuery(b) {
    // Do something that takes a while
    return sleep(1000, (v) => {
        nrows.value = v.length;
        return v
    }, b.b);
    //return b.b;
}
return {nRecords,nrows,buffer_data,bufferPush,buffer,timeout,sleep,pointStream,fakeQuery,dependsFakeQuery};
}});

define({id: "3165f5ce", inline: true, inputs: ["nRecords","display"], body: async (nRecords,display) => {
display(await(
nRecords
))
}});

define({id: "4284f789", inline: true, inputs: ["Inputs","fakeQuery","query","display"], body: async (Inputs,fakeQuery,query,display) => {
display(await(
Inputs.table(fakeQuery(query))
))
}});

define({id: "923238c1", inline: true, inputs: ["nrows","display"], body: async (nrows,display) => {
display(await(
nrows
))
}});

define({id: "8551806a", inline: true, inputs: ["Inputs","dependsFakeQuery","buffer","display"], body: async (Inputs,dependsFakeQuery,buffer,display) => {
display(await(
Inputs.table(dependsFakeQuery(buffer))
))
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">iSamples Viewer</a></li>
  </ol>
  <ol>
    <section class="observablehq-section-active">
      <summary>Viewer</summary>
      <ol>
    <li class="observablehq-link"><a href="./">Index</a></li>
    <li class="observablehq-link"><a href="./ds_view.html">Dataset</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./search_isb.html">iSB PoC</a></li>
    <li class="observablehq-link"><a href="./data_source.html">Data Source</a></li>
      </ol>
    </section>
  </ol>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
</nav>
</aside>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1 id="proof-of-concept---query-isb-using-observable-framework" tabindex="-1"><a class="observablehq-header-anchor" href="#proof-of-concept---query-isb-using-observable-framework">Proof of concept - Query iSB using Observable Framework</a></h1>
<p>This is a proof of concept document for generating a simple UI for iSB using OF.</p>
<div id="cell-d24d9d21" class="observablehq observablehq--block"></div>
<p>The current value is <span id="cell-a8b77192"><span class="observablehq-loading"></span></span>.</p>
<div id="cell-2346b82f" class="observablehq observablehq--block"></div>
<p>current match records = <span id="cell-3165f5ce"><span class="observablehq-loading"></span></span></p>
<p>Depends on input to Query:</p>
<p><span id="cell-4284f789"><span class="observablehq-loading"></span></span></p>
<p>Depends on output of fakeQuery (count=<span id="cell-923238c1"><span class="observablehq-loading"></span></span>):</p>
<p><span id="cell-8551806a"><span class="observablehq-loading"></span></span></p>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./ds_view.html"><span>Dataset</span></a><a rel="next" href="./data_source.html"><span>Data Source</span></a></nav>
<div>iSamples export viewer.</div>
</footer>
</div>
